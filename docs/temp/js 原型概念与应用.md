# JS 原型概念与应用

头脑风暴：

核心问题：传统的面向对象语言是如何新建对象以及继承类的，而使用类是为了共享一些公共的方法和属性。

JS 又是如何通过原型这个概念来实现这两个概念的，原则上是基于类继承与基于原型继承的两种区别。

## 前言

如果向你请教“原型”这两个字是什么意思，你会怎么解释呢？不同领域的人可能有不同的见解。在文学电影作品领域，主线剧情便是一个原型，例如罗密欧与茱丽叶是是遭遇家人反对为爱殉情男女的原型，跟中国故事的梁山伯与祝英台很像。另外，故事中的人物也可以是原型，例如英雄的原型。在互联网领域更是细分不少，在游戏开发中，一个原型是可以快速试玩的 demo。对于网站开发，原型可以起始于产品经理手中的线框图。

那么原型是什么呢，接下来本文会从一般的原型说到 JS 的原型以及 JS 为什么需要原型。

**摘要**：

- 什么是原型
- JS 中的原型
- JS 为什么需要原型链
- **proto** 与 prototype 的区别
- 应用场景

**面向读者**：对于 JS 原型链概念模糊的前端工程师，说不清`proto` 与 `prototype` 的区别。

## 什么是原型？

举个例子，你还记得 2016 年大火的动画电影是什么？那就是新海诚的作品《你的名字》，且不少奏乐动听，在剧情上也让人很深刻。剧情并非以单纯恋爱题材为主，而是“有着见面的命运但迟迟无法相见的两人”。而这部作用的原型，便是以早期的新海城[《十字路口》视频链接]()为原型。

![](../.vuepress/public/images/2020-06-08-07-53-09-js-prototype-01.png)

在文学电影创作领域，除了剧情外，人物主角也是先从原型制作而来。可以看看《虐杀原型》这个游戏的主角纸面原型构造图，除了设定好人物的外表外，更重要的是要设定他的行为（功能）：

[虐杀原型，人物构造图]()

。无论是故事剧情、人物，还是制造一个工业产品，所谓原型就是最初的样例、模型（很多时候模型和原型视为同一个东西）或者是为了测试概念而构建的产品。

### 原型的特点与目的

原型最本质的特点是，它是你最终制作的成品的最小规模，但具有核心功能的东西。它的目的是为了让我们可以快速多次测试自己的想法是否正确，比如一个游戏设计师，他需要不断制作具备核心功能的游戏原型，测试游戏原型，以来测试游戏的机制、规则等是否合理。当然在制作制作原型，他也可以参考成功的游戏的原型。

最早视觉上可以交互的原型，便是纸面原型（也就是在纸上画画，以及使用一些玩具类的东西构建）。

原型的规模大小是相对成品而言的，而在每个阶段都可以成为下一个阶段的原型，也就是说原型之间可以进行`继承`，从纸面原型到真正可以进行交互的原型。

[一个机器人或虐杀原型，从纸面到真正可以动的模型 gif]()

### 原型经历的阶段

![](../.vuepress/public/images/2020-06-09-07-22-37-js-prototype-01.png)

从原型到成品，也不是一次到位，其中也经历了很多的版本迭代，跟我们编程一样的道理，肯定不是下面这样一次完成。

（画马）

## 计算机编程中的原型

在计算机编程中是通过`面向对象编程`概念实现原型的。要想了解何为面向对象编程，目的是什么？让我们先回顾`面向过程`编程，举个例子，如果我们要编写一个人物，他具有从卧姿转为站姿的功能。
对于计算机来说这样复杂的命令需要拆分为一系列简单命令，如何用简单命令指挥另外一个人从站立状态转为行走状态呢？

![](../.vuepress/public/images/2020-06-15-08-55-31-walk.png)

首先，让同伴仰卧在地板上，然后告诉他严格按你所发出的命令的字面含义做相应的动作。你的目标是向同伴发出一系列命令，使他走起来。但你不能使用“走起来”之类的复杂命令，只能向指挥机器人一样使用简单命令，例如。

1. 以左脚为支撑，提起你的右脚，以躯干为轴心，向前跨 30 度
2. 向前甩动你的左臂，右臂同时朝后摆动。
3. 以右脚为支撑，提起你的左脚，以躯干为轴心，向前跨 30 度
4. 向前甩动你的右臂，左臂同时朝后摆动。
5. 重新回到第 1 步骤。

```js
Walk() {
  while(time > 30000) {
    LiftRightFoot()
    SwingLeftAndRightArm()
    LiftLeftFoot()
    SwingLeftAndRightArm()
    time++ 
  }
}
```

可以看到对于人类来说一个简单的站立动作在计算机上需要拆分成多个步骤。此时，如果我们又需要编写人物 B，它也具有行走的功能。这时我们不得不复制上面的代码到人物 B 里。如果使用面向对象是怎么做的呢？、

<!-- 假设你要模拟一个拍摄电影的场景。 -->

面向对象，可以共享对象中的属性和方法，提高可维护性和复用性。

那面向对象，首先得有个对象。生活中的对象应该是这样的，国家安排吗？

![男女结对编程👀鼓励师]()

编程中，得通过类进行实例化生成。所以要实现面向对象，先要实现类的定义。

总结下，面向对象的基本概念。

- 类
- 实例
- 方法

两种实现面向对象思想的方法，基于类实现的和基于原型实现。

### 传统面向对象语言

在面向对象编程中，最重要的特点就是根据类创建对象与类之间继承的概念了。在很多面向对象语言中如 java 中，我们可以通过声明一个类作为基类，然后通过继承这个基类定义一个新类。

```java
Employee
```

然后，而基于这个人物类进行实例化出男人 man 和女人 woman，这个人物类是 man 和 woman 的原型。

```java
篮球运动员
Manager
```

<!-- 克隆 -->

举个例子

<!-- 2K NBA online，已经具备基本的篮球能力的原型，开始只有基本的人物外表，然后你可以进行自定义外表，塑造出你喜欢的形象。（这个例子不太适合，更适合组合系统（也就是装饰器）） -->
<!-- 动物，人 -->

这里的基类和人物类都是原型，男人和女人对象的原型是人物类，而人物类的原型又是。

除了这种直观的原型外，还有数据原型（数据的迁移、集成）等。

### 基于原型继承的面向对象 JS

对比如何定义类、如何继承，JS 使用构造函数与原型实现。

传统面向对象 java 通过类的构造函数进行实例化。

而 JS 没有类的概念，但是可以定义构造函数，通过构造函数创建对象，任何的 javaScript 函数都可以是构造函数。使用 prototype 定义公共的属性和方法以此替代没有类的定义。

在 js 面向对象编程中，除了原型（`prototype`） 这个词外，构造器（`contructor`）也是我们接触比较多的术语。两者有什么区别呢，有哪些应用场景。

在传统的基于 Class 语言如 Java、C++、C# 中，继承的本质是扩展一个已有的 Class，并生成新的 Subclass。这类语言严格区分类和实例，继承实际上是类型的扩展。但是，JavaScript 无法直接扩展一个 Class。

因为在 js 语言中没有类的概念（为什么没有？），因此使用原型来实现新对象实例的创建和继承。

js 没有 extend 以及 构造函数这两个东西，因此使用 prototype 和 constructor 来间接实现面向对象编程。

### 一张图对比

<!-- 一张图对比看是否需要放到其他位置 -->

无论是基于类的 java 还是基于原型的 js ，都是为了实现面向对象的概念，可以统一理解为基于原型的实现。只不过 java 通过 class 和类的构造函数定义原型，而 js 通过 prototype 和构造函数来定义原型，本质上都是基于原型开发。

### 构造器（构造函数）与原型的关系

构造器（构造函数），英文是 contructor，它是可以根据原型构造实例对象的机器，提供消费者（用户）可以基于这个原型（在传统面向对象中就是当前整个类）进行初始化状态所用。

new bar() 这个 bar 是原型，而 bar 继承的类也是原型。通常我们 `a = new bar()` 也是调用 bar 类的构造函数，然后基于以整个类为原型进行创建新的对象。bar 为 a 的构造函数，则 a 为 bar 的一个实例。而 bar 作为原型还可以继承其他的原型例如 foo。

C#、Java 都通过 class 进行类的定义，JS 通过 prototype 属性，让我们来具体看看 JS 中基于原型的实现过程。

## 细说 JS 中的原型

下面具体说说 JS 中的原型。

### 什么是原型链

- 层层访问

<!-- 同样使用上面的传统面向对象的继承 -->

### 为什么需要原型链

- 使用原型链进行继承

### JS 是如何使用原型链进行类的继承的

- 对象构造器
- 重写 contructor 的问题
- 一些操作符 instanceof typeof in 操作符

### 使用 ES6 的 class 实现继承

## \_\_proto、prototype、constructor 区别

js 中的 constructor 跟传统面向对象的构造函数是一样的道理。

### **proto** 与 prototype 的区别

### constructor 与 prototype 的区别

### 在 调试器（debugger）中查看属性

## 应用场景

除了继承之外，理解计算机中的原型可以让我们做什么

### 更新轮子：给第三方库、框架增加属性

[vue-plugin-event-bus](https://github.com/shooterRao/vue-plugin-event-bus/blob/master/src/index.ts)

给 vue 写插件。
除了在 window 对象外
要注意在大型项目中，prototype 属性的冲突问题。

### 写个轮子：一棵树

## 小结

<!-- 构造器。 -->

## 参考资料

- [Details of the object model](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Details_of_the_Object_Model) 值得精读的 MDN 文档，说清楚了基于类继承与基于原型继承的区别。
- [Object.prototype.constructor](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/constructor)
- [深入探究 Function & Object 鸡蛋问题](https://github.com/yygmind/blog/issues/35)
- [【进阶 5-2 期】图解原型链及其继承优缺点](https://github.com/yygmind/blog/issues/35)
- [【进阶 5-1 期】重新认识构造函数、原型和原型链](https://juejin.im/post/5c6a9c10f265da2db87b98f3)
- [wiki 原型](https://zh.wikipedia.org/wiki/%E5%8E%9F%E5%9E%8B)
- [Prototype](https://en.wikipedia.org/wiki/Prototype#cite_note-:0-1)
- [所谓原型，是个什么东西？](http://www.woshipm.com/pd/144880.html)
- [廖雪峰 JavaScript 教程](https://www.liaoxuefeng.com/wiki/1022910821149312/1023021997355072)
- [再谈 JavaScript 面向对象思想及继承](https://segmentfault.com/a/1190000011770117)
- [JS 和其他面向对象语言的区别](https://www.jianshu.com/p/387677d13f99?utm_campaign=maleskine&utm_content=note&utm_medium=seo_notes&utm_source=recommendation)
- [Trying to understand the difference between prototype and constructor in JavaScript](https://stackoverflow.com/questions/28600238/trying-to-understand-the-difference-between-prototype-and-constructor-in-javascr)
- [java 继承](https://www.liaoxuefeng.com/wiki/1252599548343744/1260454548196032)
- [简单粗暴地理解 js 原型链–js 面向对象编程](https://mp.weixin.qq.com/s/93CQRYj8TraDIKeJxNGPAQ)
